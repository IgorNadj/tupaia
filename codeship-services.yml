admin-panel:
  build:
    dockerfile: frontend.Dockerfile
    args:
      package: admin-panel
  encrypted_env_file: ./packages/admin-panel/ci-env-vars.encrypted
  environment:
    CI_PACKAGE: admin-panel
  volumes:
    # mapping to `.ssh` directory ensures that `id_rsa` file persists to subsequent steps
    - ./.ssh:/root/.ssh

web-frontend:
  build:
    dockerfile: frontend.Dockerfile
    args:
      package: web-frontend
  encrypted_env_file: ./packages/web-frontend/ci-env-vars.encrypted
  environment:
    CI_PACKAGE: web-frontend
  volumes:
    # mapping to `.ssh` directory ensures that `id_rsa` file persists to subsequent steps
    - ./.ssh:/root/.ssh

web-config-server:
  build:
    dockerfile: frontend.Dockerfile
    args:
      package: web-config-server
  encrypted_env_file: ./packages/web-config-server/ci-env-vars.encrypted
  environment:
    CI_PACKAGE: web-config-server
  depends_on:
    - db
  volumes:
    # mapping to `.ssh` directory ensures that `id_rsa` file persists to subsequent steps
    - ./.ssh:/root/.ssh

meditrak-server:
  build:
    dockerfile: frontend.Dockerfile
    args:
      package: meditrak-server
  encrypted_env_file: ./packages/meditrak-server/ci-env-vars.encrypted
  environment:
    CI_PACKAGE: meditrak-server
  depends_on:
    - db
  volumes:
    # mapping to `.ssh` directory ensures that `id_rsa` file persists to subsequent steps
    - ./.ssh:/root/.ssh

db:
  image: mdillon/postgis:9.6-alpine
