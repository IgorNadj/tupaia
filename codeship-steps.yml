- type: serial
  name: pull latest into ec2
  service: admin-panel # doesn't matter which, so long as we just do this group of steps once for all packages
  steps:
    - name: reinstate SSH Private Key File
      command: /bin/bash -c "echo -e $PRIVATE_SSH_KEY >> /root/.ssh/id_rsa"
    - name: chmod id_rsa
      command: chmod 600 /root/.ssh/id_rsa
    - name: pull latest and install dependencies
      command: "./packages/devops/scripts/ci/pullLatest.sh"

- type: parallel
  name: frontend-deploy
  services:
    - admin-panel
  steps:
    - name: deploy
      command: "./packages/devops/scripts/ci/deployFrontend.sh"
