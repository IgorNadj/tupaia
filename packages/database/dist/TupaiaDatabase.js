'use strict';

var cov_ifas5nbx0 = function () {
  var path = '/Users/Edwin/Documents/Git/tupaia/packages/database/src/TupaiaDatabase.js',
      hash = '7265e90a4e1c4f89ab55c6b21c9590cec5b205f9',
      Function = function () {}.constructor,
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/Edwin/Documents/Git/tupaia/packages/database/src/TupaiaDatabase.js',
    statementMap: {
      '0': {
        start: {
          line: 15,
          column: 22
        },
        end: {
          line: 21,
          column: 1
        }
      },
      '1': {
        start: {
          line: 23,
          column: 34
        },
        end: {
          line: 27,
          column: 1
        }
      },
      '2': {
        start: {
          line: 29,
          column: 26
        },
        end: {
          line: 39,
          column: 1
        }
      },
      '3': {
        start: {
          line: 43,
          column: 34
        },
        end: {
          line: 43,
          column: 37
        }
      },
      '4': {
        start: {
          line: 47,
          column: 4
        },
        end: {
          line: 47,
          column: 19
        }
      },
      '5': {
        start: {
          line: 48,
          column: 4
        },
        end: {
          line: 48,
          column: 29
        }
      },
      '6': {
        start: {
          line: 51,
          column: 4
        },
        end: {
          line: 51,
          column: 46
        }
      },
      '7': {
        start: {
          line: 53,
          column: 30
        },
        end: {
          line: 65,
          column: 5
        }
      },
      '8': {
        start: {
          line: 54,
          column: 6
        },
        end: {
          line: 59,
          column: 12
        }
      },
      '9': {
        start: {
          line: 60,
          column: 6
        },
        end: {
          line: 63,
          column: 7
        }
      },
      '10': {
        start: {
          line: 61,
          column: 8
        },
        end: {
          line: 61,
          column: 66
        }
      },
      '11': {
        start: {
          line: 62,
          column: 8
        },
        end: {
          line: 62,
          column: 76
        }
      },
      '12': {
        start: {
          line: 64,
          column: 6
        },
        end: {
          line: 64,
          column: 18
        }
      },
      '13': {
        start: {
          line: 66,
          column: 4
        },
        end: {
          line: 66,
          column: 49
        }
      },
      '14': {
        start: {
          line: 68,
          column: 4
        },
        end: {
          line: 68,
          column: 39
        }
      },
      '15': {
        start: {
          line: 72,
          column: 4
        },
        end: {
          line: 72,
          column: 32
        }
      },
      '16': {
        start: {
          line: 73,
          column: 4
        },
        end: {
          line: 73,
          column: 30
        }
      },
      '17': {
        start: {
          line: 77,
          column: 4
        },
        end: {
          line: 77,
          column: 76
        }
      },
      '18': {
        start: {
          line: 81,
          column: 19
        },
        end: {
          line: 81,
          column: 64
        }
      },
      '19': {
        start: {
          line: 82,
          column: 4
        },
        end: {
          line: 93,
          column: 5
        }
      },
      '20': {
        start: {
          line: 83,
          column: 42
        },
        end: {
          line: 83,
          column: 97
        }
      },
      '21': {
        start: {
          line: 84,
          column: 6
        },
        end: {
          line: 90,
          column: 7
        }
      },
      '22': {
        start: {
          line: 85,
          column: 8
        },
        end: {
          line: 89,
          column: 9
        }
      },
      '23': {
        start: {
          line: 86,
          column: 10
        },
        end: {
          line: 86,
          column: 63
        }
      },
      '24': {
        start: {
          line: 88,
          column: 10
        },
        end: {
          line: 88,
          column: 27
        }
      },
      '25': {
        start: {
          line: 92,
          column: 6
        },
        end: {
          line: 92,
          column: 15
        }
      },
      '26': {
        start: {
          line: 97,
          column: 4
        },
        end: {
          line: 97,
          column: 72
        }
      },
      '27': {
        start: {
          line: 102,
          column: 4
        },
        end: {
          line: 104,
          column: 5
        }
      },
      '28': {
        start: {
          line: 103,
          column: 6
        },
        end: {
          line: 103,
          column: 47
        }
      },
      '29': {
        start: {
          line: 105,
          column: 4
        },
        end: {
          line: 105,
          column: 47
        }
      },
      '30': {
        start: {
          line: 109,
          column: 4
        },
        end: {
          line: 111,
          column: 6
        }
      },
      '31': {
        start: {
          line: 110,
          column: 6
        },
        end: {
          line: 110,
          column: 54
        }
      },
      '32': {
        start: {
          line: 115,
          column: 4
        },
        end: {
          line: 115,
          column: 33
        }
      },
      '33': {
        start: {
          line: 116,
          column: 4
        },
        end: {
          line: 116,
          column: 54
        }
      },
      '34': {
        start: {
          line: 130,
          column: 4
        },
        end: {
          line: 133,
          column: 5
        }
      },
      '35': {
        start: {
          line: 132,
          column: 6
        },
        end: {
          line: 132,
          column: 46
        }
      },
      '36': {
        start: {
          line: 135,
          column: 4
        },
        end: {
          line: 135,
          column: 48
        }
      },
      '37': {
        start: {
          line: 142,
          column: 4
        },
        end: {
          line: 142,
          column: 33
        }
      },
      '38': {
        start: {
          line: 143,
          column: 4
        },
        end: {
          line: 143,
          column: 48
        }
      },
      '39': {
        start: {
          line: 147,
          column: 4
        },
        end: {
          line: 150,
          column: 5
        }
      },
      '40': {
        start: {
          line: 148,
          column: 76
        },
        end: {
          line: 148,
          column: 92
        }
      },
      '41': {
        start: {
          line: 149,
          column: 6
        },
        end: {
          line: 149,
          column: 74
        }
      },
      '42': {
        start: {
          line: 151,
          column: 4
        },
        end: {
          line: 158,
          column: 6
        }
      },
      '43': {
        start: {
          line: 162,
          column: 20
        },
        end: {
          line: 162,
          column: 80
        }
      },
      '44': {
        start: {
          line: 163,
          column: 4
        },
        end: {
          line: 163,
          column: 61
        }
      },
      '45': {
        start: {
          line: 167,
          column: 4
        },
        end: {
          line: 167,
          column: 53
        }
      },
      '46': {
        start: {
          line: 172,
          column: 16
        },
        end: {
          line: 182,
          column: 4
        }
      },
      '47': {
        start: {
          line: 184,
          column: 4
        },
        end: {
          line: 184,
          column: 32
        }
      },
      '48': {
        start: {
          line: 188,
          column: 4
        },
        end: {
          line: 188,
          column: 70
        }
      },
      '49': {
        start: {
          line: 192,
          column: 4
        },
        end: {
          line: 192,
          column: 70
        }
      },
      '50': {
        start: {
          line: 196,
          column: 19
        },
        end: {
          line: 196,
          column: 56
        }
      },
      '51': {
        start: {
          line: 197,
          column: 4
        },
        end: {
          line: 197,
          column: 85
        }
      },
      '52': {
        start: {
          line: 202,
          column: 19
        },
        end: {
          line: 202,
          column: 83
        }
      },
      '53': {
        start: {
          line: 203,
          column: 4
        },
        end: {
          line: 203,
          column: 41
        }
      },
      '54': {
        start: {
          line: 208,
          column: 4
        },
        end: {
          line: 210,
          column: 5
        }
      },
      '55': {
        start: {
          line: 209,
          column: 6
        },
        end: {
          line: 209,
          column: 31
        }
      },
      '56': {
        start: {
          line: 211,
          column: 4
        },
        end: {
          line: 215,
          column: 7
        }
      },
      '57': {
        start: {
          line: 217,
          column: 4
        },
        end: {
          line: 219,
          column: 5
        }
      },
      '58': {
        start: {
          line: 218,
          column: 6
        },
        end: {
          line: 218,
          column: 20
        }
      },
      '59': {
        start: {
          line: 221,
          column: 27
        },
        end: {
          line: 221,
          column: 35
        }
      },
      '60': {
        start: {
          line: 222,
          column: 4
        },
        end: {
          line: 225,
          column: 5
        }
      },
      '61': {
        start: {
          line: 223,
          column: 28
        },
        end: {
          line: 223,
          column: 75
        }
      },
      '62': {
        start: {
          line: 224,
          column: 6
        },
        end: {
          line: 224,
          column: 41
        }
      },
      '63': {
        start: {
          line: 226,
          column: 4
        },
        end: {
          line: 226,
          column: 26
        }
      },
      '64': {
        start: {
          line: 236,
          column: 4
        },
        end: {
          line: 243,
          column: 6
        }
      },
      '65': {
        start: {
          line: 247,
          column: 4
        },
        end: {
          line: 247,
          column: 58
        }
      },
      '66': {
        start: {
          line: 252,
          column: 18
        },
        end: {
          line: 252,
          column: 30
        }
      },
      '67': {
        start: {
          line: 253,
          column: 42
        },
        end: {
          line: 253,
          column: 83
        }
      },
      '68': {
        start: {
          line: 254,
          column: 22
        },
        end: {
          line: 254,
          column: 85
        }
      },
      '69': {
        start: {
          line: 256,
          column: 27
        },
        end: {
          line: 259,
          column: 18
        }
      },
      '70': {
        start: {
          line: 257,
          column: 6
        },
        end: {
          line: 259,
          column: 18
        }
      },
      '71': {
        start: {
          line: 262,
          column: 20
        },
        end: {
          line: 262,
          column: 89
        }
      },
      '72': {
        start: {
          line: 262,
          column: 60
        },
        end: {
          line: 262,
          column: 88
        }
      },
      '73': {
        start: {
          line: 265,
          column: 19
        },
        end: {
          line: 265,
          column: 76
        }
      },
      '74': {
        start: {
          line: 265,
          column: 59
        },
        end: {
          line: 265,
          column: 75
        }
      },
      '75': {
        start: {
          line: 268,
          column: 21
        },
        end: {
          line: 268,
          column: 92
        }
      },
      '76': {
        start: {
          line: 268,
          column: 63
        },
        end: {
          line: 268,
          column: 91
        }
      },
      '77': {
        start: {
          line: 271,
          column: 20
        },
        end: {
          line: 274,
          column: 5
        }
      },
      '78': {
        start: {
          line: 273,
          column: 20
        },
        end: {
          line: 273,
          column: 77
        }
      },
      '79': {
        start: {
          line: 277,
          column: 33
        },
        end: {
          line: 280,
          column: 5
        }
      },
      '80': {
        start: {
          line: 281,
          column: 4
        },
        end: {
          line: 283,
          column: 7
        }
      },
      '81': {
        start: {
          line: 282,
          column: 6
        },
        end: {
          line: 282,
          column: 68
        }
      },
      '82': {
        start: {
          line: 284,
          column: 4
        },
        end: {
          line: 288,
          column: 7
        }
      },
      '83': {
        start: {
          line: 287,
          column: 6
        },
        end: {
          line: 287,
          column: 82
        }
      },
      '84': {
        start: {
          line: 291,
          column: 19
        },
        end: {
          line: 300,
          column: 5
        }
      },
      '85': {
        start: {
          line: 301,
          column: 4
        },
        end: {
          line: 301,
          column: 21
        }
      },
      '86': {
        start: {
          line: 305,
          column: 4
        },
        end: {
          line: 311,
          column: 6
        }
      },
      '87': {
        start: {
          line: 315,
          column: 4
        },
        end: {
          line: 315,
          column: 43
        }
      },
      '88': {
        start: {
          line: 323,
          column: 20
        },
        end: {
          line: 323,
          column: 63
        }
      },
      '89': {
        start: {
          line: 324,
          column: 4
        },
        end: {
          line: 333,
          column: 5
        }
      },
      '90': {
        start: {
          line: 325,
          column: 6
        },
        end: {
          line: 332,
          column: 9
        }
      },
      '91': {
        start: {
          line: 334,
          column: 4
        },
        end: {
          line: 334,
          column: 19
        }
      },
      '92': {
        start: {
          line: 338,
          column: 20
        },
        end: {
          line: 338,
          column: 63
        }
      },
      '93': {
        start: {
          line: 339,
          column: 4
        },
        end: {
          line: 339,
          column: 42
        }
      },
      '94': {
        start: {
          line: 343,
          column: 4
        },
        end: {
          line: 343,
          column: 62
        }
      },
      '95': {
        start: {
          line: 347,
          column: 4
        },
        end: {
          line: 347,
          column: 43
        }
      },
      '96': {
        start: {
          line: 368,
          column: 4
        },
        end: {
          line: 370,
          column: 5
        }
      },
      '97': {
        start: {
          line: 369,
          column: 6
        },
        end: {
          line: 369,
          column: 35
        }
      },
      '98': {
        start: {
          line: 372,
          column: 18
        },
        end: {
          line: 372,
          column: 40
        }
      },
      '99': {
        start: {
          line: 374,
          column: 4
        },
        end: {
          line: 376,
          column: 7
        }
      },
      '100': {
        start: {
          line: 375,
          column: 6
        },
        end: {
          line: 375,
          column: 50
        }
      },
      '101': {
        start: {
          line: 378,
          column: 19
        },
        end: {
          line: 378,
          column: 43
        }
      },
      '102': {
        start: {
          line: 379,
          column: 28
        },
        end: {
          line: 379,
          column: 30
        }
      },
      '103': {
        start: {
          line: 382,
          column: 4
        },
        end: {
          line: 384,
          column: 7
        }
      },
      '104': {
        start: {
          line: 383,
          column: 6
        },
        end: {
          line: 383,
          column: 64
        }
      },
      '105': {
        start: {
          line: 386,
          column: 4
        },
        end: {
          line: 386,
          column: 27
        }
      },
      '106': {
        start: {
          line: 395,
          column: 4
        },
        end: {
          line: 397,
          column: 5
        }
      },
      '107': {
        start: {
          line: 396,
          column: 6
        },
        end: {
          line: 396,
          column: 35
        }
      },
      '108': {
        start: {
          line: 399,
          column: 19
        },
        end: {
          line: 399,
          column: 73
        }
      },
      '109': {
        start: {
          line: 400,
          column: 4
        },
        end: {
          line: 400,
          column: 23
        }
      },
      '110': {
        start: {
          line: 410,
          column: 60
        },
        end: {
          line: 410,
          column: 71
        }
      },
      '111': {
        start: {
          line: 411,
          column: 14
        },
        end: {
          line: 411,
          column: 36
        }
      },
      '112': {
        start: {
          line: 414,
          column: 2
        },
        end: {
          line: 416,
          column: 3
        }
      },
      '113': {
        start: {
          line: 415,
          column: 4
        },
        end: {
          line: 415,
          column: 43
        }
      },
      '114': {
        start: {
          line: 419,
          column: 2
        },
        end: {
          line: 421,
          column: 3
        }
      },
      '115': {
        start: {
          line: 420,
          column: 4
        },
        end: {
          line: 420,
          column: 48
        }
      },
      '116': {
        start: {
          line: 424,
          column: 2
        },
        end: {
          line: 426,
          column: 3
        }
      },
      '117': {
        start: {
          line: 425,
          column: 4
        },
        end: {
          line: 425,
          column: 96
        }
      },
      '118': {
        start: {
          line: 425,
          column: 46
        },
        end: {
          line: 425,
          column: 93
        }
      },
      '119': {
        start: {
          line: 429,
          column: 2
        },
        end: {
          line: 429,
          column: 93
        }
      },
      '120': {
        start: {
          line: 432,
          column: 2
        },
        end: {
          line: 437,
          column: 3
        }
      },
      '121': {
        start: {
          line: 433,
          column: 4
        },
        end: {
          line: 436,
          column: 5
        }
      },
      '122': {
        start: {
          line: 434,
          column: 38
        },
        end: {
          line: 434,
          column: 56
        }
      },
      '123': {
        start: {
          line: 435,
          column: 6
        },
        end: {
          line: 435,
          column: 51
        }
      },
      '124': {
        start: {
          line: 440,
          column: 2
        },
        end: {
          line: 442,
          column: 3
        }
      },
      '125': {
        start: {
          line: 441,
          column: 4
        },
        end: {
          line: 441,
          column: 39
        }
      },
      '126': {
        start: {
          line: 445,
          column: 2
        },
        end: {
          line: 447,
          column: 3
        }
      },
      '127': {
        start: {
          line: 446,
          column: 4
        },
        end: {
          line: 446,
          column: 41
        }
      },
      '128': {
        start: {
          line: 450,
          column: 2
        },
        end: {
          line: 452,
          column: 3
        }
      },
      '129': {
        start: {
          line: 451,
          column: 4
        },
        end: {
          line: 451,
          column: 35
        }
      },
      '130': {
        start: {
          line: 454,
          column: 2
        },
        end: {
          line: 457,
          column: 3
        }
      },
      '131': {
        start: {
          line: 456,
          column: 4
        },
        end: {
          line: 456,
          column: 25
        }
      },
      '132': {
        start: {
          line: 461,
          column: 2
        },
        end: {
          line: 461,
          column: 15
        }
      },
      '133': {
        start: {
          line: 465,
          column: 2
        },
        end: {
          line: 467,
          column: 3
        }
      },
      '134': {
        start: {
          line: 466,
          column: 4
        },
        end: {
          line: 466,
          column: 21
        }
      },
      '135': {
        start: {
          line: 468,
          column: 2
        },
        end: {
          line: 503,
          column: 16
        }
      },
      '136': {
        start: {
          line: 471,
          column: 4
        },
        end: {
          line: 482,
          column: 5
        }
      },
      '137': {
        start: {
          line: 472,
          column: 6
        },
        end: {
          line: 474,
          column: 9
        }
      },
      '138': {
        start: {
          line: 473,
          column: 8
        },
        end: {
          line: 473,
          column: 36
        }
      },
      '139': {
        start: {
          line: 475,
          column: 11
        },
        end: {
          line: 482,
          column: 5
        }
      },
      '140': {
        start: {
          line: 476,
          column: 6
        },
        end: {
          line: 478,
          column: 9
        }
      },
      '141': {
        start: {
          line: 477,
          column: 8
        },
        end: {
          line: 477,
          column: 36
        }
      },
      '142': {
        start: {
          line: 479,
          column: 11
        },
        end: {
          line: 482,
          column: 5
        }
      },
      '143': {
        start: {
          line: 480,
          column: 42
        },
        end: {
          line: 480,
          column: 47
        }
      },
      '144': {
        start: {
          line: 481,
          column: 6
        },
        end: {
          line: 481,
          column: 50
        }
      },
      '145': {
        start: {
          line: 483,
          column: 4
        },
        end: {
          line: 485,
          column: 5
        }
      },
      '146': {
        start: {
          line: 484,
          column: 6
        },
        end: {
          line: 484,
          column: 24
        }
      },
      '147': {
        start: {
          line: 486,
          column: 4
        },
        end: {
          line: 488,
          column: 5
        }
      },
      '148': {
        start: {
          line: 487,
          column: 6
        },
        end: {
          line: 487,
          column: 39
        }
      },
      '149': {
        start: {
          line: 494,
          column: 8
        },
        end: {
          line: 494,
          column: 13
        }
      },
      '150': {
        start: {
          line: 495,
          column: 4
        },
        end: {
          line: 500,
          column: 5
        }
      },
      '151': {
        start: {
          line: 496,
          column: 6
        },
        end: {
          line: 499,
          column: 9
        }
      },
      '152': {
        start: {
          line: 501,
          column: 53
        },
        end: {
          line: 501,
          column: 58
        }
      },
      '153': {
        start: {
          line: 502,
          column: 4
        },
        end: {
          line: 502,
          column: 52
        }
      },
      '154': {
        start: {
          line: 514,
          column: 6
        },
        end: {
          line: 514,
          column: 17
        }
      },
      '155': {
        start: {
          line: 515,
          column: 21
        },
        end: {
          line: 515,
          column: 58
        }
      },
      '156': {
        start: {
          line: 516,
          column: 2
        },
        end: {
          line: 525,
          column: 5
        }
      },
      '157': {
        start: {
          line: 517,
          column: 20
        },
        end: {
          line: 517,
          column: 49
        }
      },
      '158': {
        start: {
          line: 518,
          column: 4
        },
        end: {
          line: 524,
          column: 5
        }
      },
      '159': {
        start: {
          line: 523,
          column: 6
        },
        end: {
          line: 523,
          column: 59
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 46,
            column: 2
          },
          end: {
            line: 46,
            column: 3
          }
        },
        loc: {
          start: {
            line: 46,
            column: 37
          },
          end: {
            line: 69,
            column: 3
          }
        },
        line: 46
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 53,
            column: 30
          },
          end: {
            line: 53,
            column: 31
          }
        },
        loc: {
          start: {
            line: 53,
            column: 42
          },
          end: {
            line: 65,
            column: 5
          }
        },
        line: 53
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 71,
            column: 2
          },
          end: {
            line: 71,
            column: 3
          }
        },
        loc: {
          start: {
            line: 71,
            column: 12
          },
          end: {
            line: 74,
            column: 3
          }
        },
        line: 71
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 76,
            column: 2
          },
          end: {
            line: 76,
            column: 3
          }
        },
        loc: {
          start: {
            line: 76,
            column: 63
          },
          end: {
            line: 78,
            column: 3
          }
        },
        line: 76
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 80,
            column: 2
          },
          end: {
            line: 80,
            column: 3
          }
        },
        loc: {
          start: {
            line: 80,
            column: 49
          },
          end: {
            line: 94,
            column: 3
          }
        },
        line: 80
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 96,
            column: 2
          },
          end: {
            line: 96,
            column: 3
          }
        },
        loc: {
          start: {
            line: 96,
            column: 35
          },
          end: {
            line: 98,
            column: 3
          }
        },
        line: 96
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 100,
            column: 2
          },
          end: {
            line: 100,
            column: 3
          }
        },
        loc: {
          start: {
            line: 100,
            column: 49
          },
          end: {
            line: 106,
            column: 3
          }
        },
        line: 100
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 108,
            column: 2
          },
          end: {
            line: 108,
            column: 3
          }
        },
        loc: {
          start: {
            line: 108,
            column: 37
          },
          end: {
            line: 112,
            column: 3
          }
        },
        line: 108
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 109,
            column: 39
          },
          end: {
            line: 109,
            column: 40
          }
        },
        loc: {
          start: {
            line: 110,
            column: 6
          },
          end: {
            line: 110,
            column: 54
          }
        },
        line: 110
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 114,
            column: 2
          },
          end: {
            line: 114,
            column: 3
          }
        },
        loc: {
          start: {
            line: 114,
            column: 42
          },
          end: {
            line: 117,
            column: 3
          }
        },
        line: 114
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 129,
            column: 2
          },
          end: {
            line: 129,
            column: 3
          }
        },
        loc: {
          start: {
            line: 129,
            column: 17
          },
          end: {
            line: 136,
            column: 3
          }
        },
        line: 129
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 141,
            column: 2
          },
          end: {
            line: 141,
            column: 3
          }
        },
        loc: {
          start: {
            line: 141,
            column: 36
          },
          end: {
            line: 144,
            column: 3
          }
        },
        line: 141
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 146,
            column: 2
          },
          end: {
            line: 146,
            column: 3
          }
        },
        loc: {
          start: {
            line: 146,
            column: 81
          },
          end: {
            line: 159,
            column: 3
          }
        },
        line: 146
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 161,
            column: 2
          },
          end: {
            line: 161,
            column: 3
          }
        },
        loc: {
          start: {
            line: 161,
            column: 44
          },
          end: {
            line: 164,
            column: 3
          }
        },
        line: 161
      },
      '14': {
        name: '(anonymous_14)',
        decl: {
          start: {
            line: 166,
            column: 2
          },
          end: {
            line: 166,
            column: 3
          }
        },
        loc: {
          start: {
            line: 166,
            column: 36
          },
          end: {
            line: 168,
            column: 3
          }
        },
        line: 166
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 170,
            column: 2
          },
          end: {
            line: 170,
            column: 3
          }
        },
        loc: {
          start: {
            line: 170,
            column: 83
          },
          end: {
            line: 185,
            column: 3
          }
        },
        line: 170
      },
      '16': {
        name: '(anonymous_16)',
        decl: {
          start: {
            line: 187,
            column: 2
          },
          end: {
            line: 187,
            column: 3
          }
        },
        loc: {
          start: {
            line: 187,
            column: 81
          },
          end: {
            line: 189,
            column: 3
          }
        },
        line: 187
      },
      '17': {
        name: '(anonymous_17)',
        decl: {
          start: {
            line: 191,
            column: 2
          },
          end: {
            line: 191,
            column: 3
          }
        },
        loc: {
          start: {
            line: 191,
            column: 82
          },
          end: {
            line: 193,
            column: 3
          }
        },
        line: 191
      },
      '18': {
        name: '(anonymous_18)',
        decl: {
          start: {
            line: 195,
            column: 2
          },
          end: {
            line: 195,
            column: 3
          }
        },
        loc: {
          start: {
            line: 195,
            column: 68
          },
          end: {
            line: 198,
            column: 3
          }
        },
        line: 195
      },
      '19': {
        name: '(anonymous_19)',
        decl: {
          start: {
            line: 200,
            column: 2
          },
          end: {
            line: 200,
            column: 3
          }
        },
        loc: {
          start: {
            line: 200,
            column: 42
          },
          end: {
            line: 204,
            column: 3
          }
        },
        line: 200
      },
      '20': {
        name: '(anonymous_20)',
        decl: {
          start: {
            line: 206,
            column: 2
          },
          end: {
            line: 206,
            column: 3
          }
        },
        loc: {
          start: {
            line: 206,
            column: 57
          },
          end: {
            line: 227,
            column: 3
          }
        },
        line: 206
      },
      '21': {
        name: '(anonymous_21)',
        decl: {
          start: {
            line: 235,
            column: 2
          },
          end: {
            line: 235,
            column: 3
          }
        },
        loc: {
          start: {
            line: 235,
            column: 49
          },
          end: {
            line: 244,
            column: 3
          }
        },
        line: 235
      },
      '22': {
        name: '(anonymous_22)',
        decl: {
          start: {
            line: 246,
            column: 2
          },
          end: {
            line: 246,
            column: 3
          }
        },
        loc: {
          start: {
            line: 246,
            column: 50
          },
          end: {
            line: 248,
            column: 3
          }
        },
        line: 246
      },
      '23': {
        name: '(anonymous_23)',
        decl: {
          start: {
            line: 250,
            column: 2
          },
          end: {
            line: 250,
            column: 3
          }
        },
        loc: {
          start: {
            line: 250,
            column: 63
          },
          end: {
            line: 302,
            column: 3
          }
        },
        line: 250
      },
      '24': {
        name: '(anonymous_24)',
        decl: {
          start: {
            line: 256,
            column: 27
          },
          end: {
            line: 256,
            column: 28
          }
        },
        loc: {
          start: {
            line: 257,
            column: 6
          },
          end: {
            line: 259,
            column: 18
          }
        },
        line: 257
      },
      '25': {
        name: '(anonymous_25)',
        decl: {
          start: {
            line: 262,
            column: 46
          },
          end: {
            line: 262,
            column: 47
          }
        },
        loc: {
          start: {
            line: 262,
            column: 60
          },
          end: {
            line: 262,
            column: 88
          }
        },
        line: 262
      },
      '26': {
        name: '(anonymous_26)',
        decl: {
          start: {
            line: 265,
            column: 45
          },
          end: {
            line: 265,
            column: 46
          }
        },
        loc: {
          start: {
            line: 265,
            column: 59
          },
          end: {
            line: 265,
            column: 75
          }
        },
        line: 265
      },
      '27': {
        name: '(anonymous_27)',
        decl: {
          start: {
            line: 268,
            column: 49
          },
          end: {
            line: 268,
            column: 50
          }
        },
        loc: {
          start: {
            line: 268,
            column: 63
          },
          end: {
            line: 268,
            column: 91
          }
        },
        line: 268
      },
      '28': {
        name: '(anonymous_28)',
        decl: {
          start: {
            line: 273,
            column: 6
          },
          end: {
            line: 273,
            column: 7
          }
        },
        loc: {
          start: {
            line: 273,
            column: 20
          },
          end: {
            line: 273,
            column: 77
          }
        },
        line: 273
      },
      '29': {
        name: '(anonymous_29)',
        decl: {
          start: {
            line: 281,
            column: 35
          },
          end: {
            line: 281,
            column: 36
          }
        },
        loc: {
          start: {
            line: 281,
            column: 49
          },
          end: {
            line: 283,
            column: 5
          }
        },
        line: 281
      },
      '30': {
        name: '(anonymous_30)',
        decl: {
          start: {
            line: 284,
            column: 55
          },
          end: {
            line: 284,
            column: 56
          }
        },
        loc: {
          start: {
            line: 284,
            column: 69
          },
          end: {
            line: 288,
            column: 5
          }
        },
        line: 284
      },
      '31': {
        name: '(anonymous_31)',
        decl: {
          start: {
            line: 304,
            column: 2
          },
          end: {
            line: 304,
            column: 3
          }
        },
        loc: {
          start: {
            line: 304,
            column: 39
          },
          end: {
            line: 312,
            column: 3
          }
        },
        line: 304
      },
      '32': {
        name: '(anonymous_32)',
        decl: {
          start: {
            line: 314,
            column: 2
          },
          end: {
            line: 314,
            column: 3
          }
        },
        loc: {
          start: {
            line: 314,
            column: 35
          },
          end: {
            line: 316,
            column: 3
          }
        },
        line: 314
      },
      '33': {
        name: '(anonymous_33)',
        decl: {
          start: {
            line: 322,
            column: 2
          },
          end: {
            line: 322,
            column: 3
          }
        },
        loc: {
          start: {
            line: 322,
            column: 50
          },
          end: {
            line: 335,
            column: 3
          }
        },
        line: 322
      },
      '34': {
        name: '(anonymous_34)',
        decl: {
          start: {
            line: 337,
            column: 2
          },
          end: {
            line: 337,
            column: 3
          }
        },
        loc: {
          start: {
            line: 337,
            column: 24
          },
          end: {
            line: 340,
            column: 3
          }
        },
        line: 337
      },
      '35': {
        name: '(anonymous_35)',
        decl: {
          start: {
            line: 342,
            column: 2
          },
          end: {
            line: 342,
            column: 3
          }
        },
        loc: {
          start: {
            line: 342,
            column: 25
          },
          end: {
            line: 344,
            column: 3
          }
        },
        line: 342
      },
      '36': {
        name: '(anonymous_36)',
        decl: {
          start: {
            line: 346,
            column: 2
          },
          end: {
            line: 346,
            column: 3
          }
        },
        loc: {
          start: {
            line: 346,
            column: 20
          },
          end: {
            line: 348,
            column: 3
          }
        },
        line: 346
      },
      '37': {
        name: '(anonymous_37)',
        decl: {
          start: {
            line: 367,
            column: 2
          },
          end: {
            line: 367,
            column: 3
          }
        },
        loc: {
          start: {
            line: 367,
            column: 44
          },
          end: {
            line: 387,
            column: 3
          }
        },
        line: 367
      },
      '38': {
        name: '(anonymous_38)',
        decl: {
          start: {
            line: 374,
            column: 19
          },
          end: {
            line: 374,
            column: 20
          }
        },
        loc: {
          start: {
            line: 374,
            column: 33
          },
          end: {
            line: 376,
            column: 5
          }
        },
        line: 374
      },
      '39': {
        name: '(anonymous_39)',
        decl: {
          start: {
            line: 382,
            column: 35
          },
          end: {
            line: 382,
            column: 36
          }
        },
        loc: {
          start: {
            line: 382,
            column: 45
          },
          end: {
            line: 384,
            column: 5
          }
        },
        line: 382
      },
      '40': {
        name: '(anonymous_40)',
        decl: {
          start: {
            line: 394,
            column: 2
          },
          end: {
            line: 394,
            column: 3
          }
        },
        loc: {
          start: {
            line: 394,
            column: 48
          },
          end: {
            line: 401,
            column: 3
          }
        },
        line: 394
      },
      '41': {
        name: 'buildQuery',
        decl: {
          start: {
            line: 409,
            column: 9
          },
          end: {
            line: 409,
            column: 19
          }
        },
        loc: {
          start: {
            line: 409,
            column: 71
          },
          end: {
            line: 462,
            column: 1
          }
        },
        line: 409
      },
      '42': {
        name: '(anonymous_42)',
        decl: {
          start: {
            line: 425,
            column: 30
          },
          end: {
            line: 425,
            column: 31
          }
        },
        loc: {
          start: {
            line: 425,
            column: 46
          },
          end: {
            line: 425,
            column: 93
          }
        },
        line: 425
      },
      '43': {
        name: 'addWhereClause',
        decl: {
          start: {
            line: 464,
            column: 9
          },
          end: {
            line: 464,
            column: 23
          }
        },
        loc: {
          start: {
            line: 464,
            column: 42
          },
          end: {
            line: 504,
            column: 1
          }
        },
        line: 464
      },
      '44': {
        name: '(anonymous_44)',
        decl: {
          start: {
            line: 468,
            column: 38
          },
          end: {
            line: 468,
            column: 39
          }
        },
        loc: {
          start: {
            line: 468,
            column: 68
          },
          end: {
            line: 503,
            column: 3
          }
        },
        line: 468
      },
      '45': {
        name: '(anonymous_45)',
        decl: {
          start: {
            line: 472,
            column: 33
          },
          end: {
            line: 472,
            column: 34
          }
        },
        loc: {
          start: {
            line: 472,
            column: 44
          },
          end: {
            line: 474,
            column: 7
          }
        },
        line: 472
      },
      '46': {
        name: '(anonymous_46)',
        decl: {
          start: {
            line: 476,
            column: 32
          },
          end: {
            line: 476,
            column: 33
          }
        },
        loc: {
          start: {
            line: 476,
            column: 43
          },
          end: {
            line: 478,
            column: 7
          }
        },
        line: 476
      },
      '47': {
        name: 'addJoin',
        decl: {
          start: {
            line: 506,
            column: 9
          },
          end: {
            line: 506,
            column: 16
          }
        },
        loc: {
          start: {
            line: 506,
            column: 53
          },
          end: {
            line: 526,
            column: 1
          }
        },
        line: 506
      },
      '48': {
        name: '(anonymous_48)',
        decl: {
          start: {
            line: 516,
            column: 41
          },
          end: {
            line: 516,
            column: 42
          }
        },
        loc: {
          start: {
            line: 516,
            column: 52
          },
          end: {
            line: 525,
            column: 3
          }
        },
        line: 516
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 55,
            column: 8
          },
          end: {
            line: 59,
            column: 11
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 55,
            column: 8
          },
          end: {
            line: 55,
            column: 29
          }
        }, {
          start: {
            line: 56,
            column: 9
          },
          end: {
            line: 59,
            column: 10
          }
        }],
        line: 55
      },
      '1': {
        loc: {
          start: {
            line: 60,
            column: 6
          },
          end: {
            line: 63,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 60,
            column: 6
          },
          end: {
            line: 63,
            column: 7
          }
        }, {
          start: {
            line: 60,
            column: 6
          },
          end: {
            line: 63,
            column: 7
          }
        }],
        line: 60
      },
      '2': {
        loc: {
          start: {
            line: 102,
            column: 4
          },
          end: {
            line: 104,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 102,
            column: 4
          },
          end: {
            line: 104,
            column: 5
          }
        }, {
          start: {
            line: 102,
            column: 4
          },
          end: {
            line: 104,
            column: 5
          }
        }],
        line: 102
      },
      '3': {
        loc: {
          start: {
            line: 130,
            column: 4
          },
          end: {
            line: 133,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 130,
            column: 4
          },
          end: {
            line: 133,
            column: 5
          }
        }, {
          start: {
            line: 130,
            column: 4
          },
          end: {
            line: 133,
            column: 5
          }
        }],
        line: 130
      },
      '4': {
        loc: {
          start: {
            line: 146,
            column: 19
          },
          end: {
            line: 146,
            column: 29
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 146,
            column: 27
          },
          end: {
            line: 146,
            column: 29
          }
        }],
        line: 146
      },
      '5': {
        loc: {
          start: {
            line: 146,
            column: 31
          },
          end: {
            line: 146,
            column: 43
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 146,
            column: 41
          },
          end: {
            line: 146,
            column: 43
          }
        }],
        line: 146
      },
      '6': {
        loc: {
          start: {
            line: 146,
            column: 45
          },
          end: {
            line: 146,
            column: 79
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 146,
            column: 59
          },
          end: {
            line: 146,
            column: 79
          }
        }],
        line: 146
      },
      '7': {
        loc: {
          start: {
            line: 147,
            column: 4
          },
          end: {
            line: 150,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 147,
            column: 4
          },
          end: {
            line: 150,
            column: 5
          }
        }, {
          start: {
            line: 147,
            column: 4
          },
          end: {
            line: 150,
            column: 5
          }
        }],
        line: 147
      },
      '8': {
        loc: {
          start: {
            line: 163,
            column: 11
          },
          end: {
            line: 163,
            column: 60
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 163,
            column: 43
          },
          end: {
            line: 163,
            column: 53
          }
        }, {
          start: {
            line: 163,
            column: 56
          },
          end: {
            line: 163,
            column: 60
          }
        }],
        line: 163
      },
      '9': {
        loc: {
          start: {
            line: 163,
            column: 11
          },
          end: {
            line: 163,
            column: 40
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 163,
            column: 11
          },
          end: {
            line: 163,
            column: 18
          }
        }, {
          start: {
            line: 163,
            column: 22
          },
          end: {
            line: 163,
            column: 40
          }
        }],
        line: 163
      },
      '10': {
        loc: {
          start: {
            line: 170,
            column: 42
          },
          end: {
            line: 170,
            column: 54
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 170,
            column: 50
          },
          end: {
            line: 170,
            column: 54
          }
        }],
        line: 170
      },
      '11': {
        loc: {
          start: {
            line: 170,
            column: 56
          },
          end: {
            line: 170,
            column: 81
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 170,
            column: 70
          },
          end: {
            line: 170,
            column: 81
          }
        }],
        line: 170
      },
      '12': {
        loc: {
          start: {
            line: 187,
            column: 40
          },
          end: {
            line: 187,
            column: 52
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 187,
            column: 48
          },
          end: {
            line: 187,
            column: 52
          }
        }],
        line: 187
      },
      '13': {
        loc: {
          start: {
            line: 187,
            column: 54
          },
          end: {
            line: 187,
            column: 79
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 187,
            column: 68
          },
          end: {
            line: 187,
            column: 79
          }
        }],
        line: 187
      },
      '14': {
        loc: {
          start: {
            line: 191,
            column: 41
          },
          end: {
            line: 191,
            column: 53
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 191,
            column: 49
          },
          end: {
            line: 191,
            column: 53
          }
        }],
        line: 191
      },
      '15': {
        loc: {
          start: {
            line: 191,
            column: 55
          },
          end: {
            line: 191,
            column: 80
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 191,
            column: 69
          },
          end: {
            line: 191,
            column: 80
          }
        }],
        line: 191
      },
      '16': {
        loc: {
          start: {
            line: 195,
            column: 40
          },
          end: {
            line: 195,
            column: 66
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 195,
            column: 64
          },
          end: {
            line: 195,
            column: 66
          }
        }],
        line: 195
      },
      '17': {
        loc: {
          start: {
            line: 197,
            column: 11
          },
          end: {
            line: 197,
            column: 84
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 197,
            column: 11
          },
          end: {
            line: 197,
            column: 17
          }
        }, {
          start: {
            line: 197,
            column: 21
          },
          end: {
            line: 197,
            column: 84
          }
        }],
        line: 197
      },
      '18': {
        loc: {
          start: {
            line: 208,
            column: 4
          },
          end: {
            line: 210,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 208,
            column: 4
          },
          end: {
            line: 210,
            column: 5
          }
        }, {
          start: {
            line: 208,
            column: 4
          },
          end: {
            line: 210,
            column: 5
          }
        }],
        line: 208
      },
      '19': {
        loc: {
          start: {
            line: 217,
            column: 4
          },
          end: {
            line: 219,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 217,
            column: 4
          },
          end: {
            line: 219,
            column: 5
          }
        }, {
          start: {
            line: 217,
            column: 4
          },
          end: {
            line: 219,
            column: 5
          }
        }],
        line: 217
      },
      '20': {
        loc: {
          start: {
            line: 304,
            column: 27
          },
          end: {
            line: 304,
            column: 37
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 304,
            column: 35
          },
          end: {
            line: 304,
            column: 37
          }
        }],
        line: 304
      },
      '21': {
        loc: {
          start: {
            line: 339,
            column: 11
          },
          end: {
            line: 339,
            column: 41
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 339,
            column: 21
          },
          end: {
            line: 339,
            column: 34
          }
        }, {
          start: {
            line: 339,
            column: 37
          },
          end: {
            line: 339,
            column: 41
          }
        }],
        line: 339
      },
      '22': {
        loc: {
          start: {
            line: 367,
            column: 19
          },
          end: {
            line: 367,
            column: 30
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 367,
            column: 28
          },
          end: {
            line: 367,
            column: 30
          }
        }],
        line: 367
      },
      '23': {
        loc: {
          start: {
            line: 367,
            column: 32
          },
          end: {
            line: 367,
            column: 42
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 367,
            column: 40
          },
          end: {
            line: 367,
            column: 42
          }
        }],
        line: 367
      },
      '24': {
        loc: {
          start: {
            line: 368,
            column: 4
          },
          end: {
            line: 370,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 368,
            column: 4
          },
          end: {
            line: 370,
            column: 5
          }
        }, {
          start: {
            line: 368,
            column: 4
          },
          end: {
            line: 370,
            column: 5
          }
        }],
        line: 368
      },
      '25': {
        loc: {
          start: {
            line: 395,
            column: 4
          },
          end: {
            line: 397,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 395,
            column: 4
          },
          end: {
            line: 397,
            column: 5
          }
        }, {
          start: {
            line: 395,
            column: 4
          },
          end: {
            line: 397,
            column: 5
          }
        }],
        line: 395
      },
      '26': {
        loc: {
          start: {
            line: 409,
            column: 45
          },
          end: {
            line: 409,
            column: 55
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 409,
            column: 53
          },
          end: {
            line: 409,
            column: 55
          }
        }],
        line: 409
      },
      '27': {
        loc: {
          start: {
            line: 409,
            column: 57
          },
          end: {
            line: 409,
            column: 69
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 409,
            column: 67
          },
          end: {
            line: 409,
            column: 69
          }
        }],
        line: 409
      },
      '28': {
        loc: {
          start: {
            line: 414,
            column: 2
          },
          end: {
            line: 416,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 414,
            column: 2
          },
          end: {
            line: 416,
            column: 3
          }
        }, {
          start: {
            line: 414,
            column: 2
          },
          end: {
            line: 416,
            column: 3
          }
        }],
        line: 414
      },
      '29': {
        loc: {
          start: {
            line: 419,
            column: 2
          },
          end: {
            line: 421,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 419,
            column: 2
          },
          end: {
            line: 421,
            column: 3
          }
        }, {
          start: {
            line: 419,
            column: 2
          },
          end: {
            line: 421,
            column: 3
          }
        }],
        line: 419
      },
      '30': {
        loc: {
          start: {
            line: 424,
            column: 2
          },
          end: {
            line: 426,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 424,
            column: 2
          },
          end: {
            line: 426,
            column: 3
          }
        }, {
          start: {
            line: 424,
            column: 2
          },
          end: {
            line: 426,
            column: 3
          }
        }],
        line: 424
      },
      '31': {
        loc: {
          start: {
            line: 429,
            column: 44
          },
          end: {
            line: 429,
            column: 83
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 429,
            column: 44
          },
          end: {
            line: 429,
            column: 64
          }
        }, {
          start: {
            line: 429,
            column: 68
          },
          end: {
            line: 429,
            column: 83
          }
        }],
        line: 429
      },
      '32': {
        loc: {
          start: {
            line: 432,
            column: 2
          },
          end: {
            line: 437,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 432,
            column: 2
          },
          end: {
            line: 437,
            column: 3
          }
        }, {
          start: {
            line: 432,
            column: 2
          },
          end: {
            line: 437,
            column: 3
          }
        }],
        line: 432
      },
      '33': {
        loc: {
          start: {
            line: 440,
            column: 2
          },
          end: {
            line: 442,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 440,
            column: 2
          },
          end: {
            line: 442,
            column: 3
          }
        }, {
          start: {
            line: 440,
            column: 2
          },
          end: {
            line: 442,
            column: 3
          }
        }],
        line: 440
      },
      '34': {
        loc: {
          start: {
            line: 445,
            column: 2
          },
          end: {
            line: 447,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 445,
            column: 2
          },
          end: {
            line: 447,
            column: 3
          }
        }, {
          start: {
            line: 445,
            column: 2
          },
          end: {
            line: 447,
            column: 3
          }
        }],
        line: 445
      },
      '35': {
        loc: {
          start: {
            line: 450,
            column: 2
          },
          end: {
            line: 452,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 450,
            column: 2
          },
          end: {
            line: 452,
            column: 3
          }
        }, {
          start: {
            line: 450,
            column: 2
          },
          end: {
            line: 452,
            column: 3
          }
        }],
        line: 450
      },
      '36': {
        loc: {
          start: {
            line: 454,
            column: 2
          },
          end: {
            line: 457,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 454,
            column: 2
          },
          end: {
            line: 457,
            column: 3
          }
        }, {
          start: {
            line: 454,
            column: 2
          },
          end: {
            line: 457,
            column: 3
          }
        }],
        line: 454
      },
      '37': {
        loc: {
          start: {
            line: 465,
            column: 2
          },
          end: {
            line: 467,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 465,
            column: 2
          },
          end: {
            line: 467,
            column: 3
          }
        }, {
          start: {
            line: 465,
            column: 2
          },
          end: {
            line: 467,
            column: 3
          }
        }],
        line: 465
      },
      '38': {
        loc: {
          start: {
            line: 471,
            column: 4
          },
          end: {
            line: 482,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 471,
            column: 4
          },
          end: {
            line: 482,
            column: 5
          }
        }, {
          start: {
            line: 471,
            column: 4
          },
          end: {
            line: 482,
            column: 5
          }
        }],
        line: 471
      },
      '39': {
        loc: {
          start: {
            line: 475,
            column: 11
          },
          end: {
            line: 482,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 475,
            column: 11
          },
          end: {
            line: 482,
            column: 5
          }
        }, {
          start: {
            line: 475,
            column: 11
          },
          end: {
            line: 482,
            column: 5
          }
        }],
        line: 475
      },
      '40': {
        loc: {
          start: {
            line: 479,
            column: 11
          },
          end: {
            line: 482,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 479,
            column: 11
          },
          end: {
            line: 482,
            column: 5
          }
        }, {
          start: {
            line: 479,
            column: 11
          },
          end: {
            line: 482,
            column: 5
          }
        }],
        line: 479
      },
      '41': {
        loc: {
          start: {
            line: 480,
            column: 14
          },
          end: {
            line: 480,
            column: 25
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 480,
            column: 20
          },
          end: {
            line: 480,
            column: 25
          }
        }],
        line: 480
      },
      '42': {
        loc: {
          start: {
            line: 483,
            column: 4
          },
          end: {
            line: 485,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 483,
            column: 4
          },
          end: {
            line: 485,
            column: 5
          }
        }, {
          start: {
            line: 483,
            column: 4
          },
          end: {
            line: 485,
            column: 5
          }
        }],
        line: 483
      },
      '43': {
        loc: {
          start: {
            line: 486,
            column: 4
          },
          end: {
            line: 488,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 486,
            column: 4
          },
          end: {
            line: 488,
            column: 5
          }
        }, {
          start: {
            line: 486,
            column: 4
          },
          end: {
            line: 488,
            column: 5
          }
        }],
        line: 486
      },
      '44': {
        loc: {
          start: {
            line: 490,
            column: 6
          },
          end: {
            line: 490,
            column: 30
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 490,
            column: 23
          },
          end: {
            line: 490,
            column: 30
          }
        }],
        line: 490
      },
      '45': {
        loc: {
          start: {
            line: 491,
            column: 6
          },
          end: {
            line: 491,
            column: 52
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 491,
            column: 19
          },
          end: {
            line: 491,
            column: 52
          }
        }],
        line: 491
      },
      '46': {
        loc: {
          start: {
            line: 491,
            column: 19
          },
          end: {
            line: 491,
            column: 52
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 491,
            column: 42
          },
          end: {
            line: 491,
            column: 46
          }
        }, {
          start: {
            line: 491,
            column: 49
          },
          end: {
            line: 491,
            column: 52
          }
        }],
        line: 491
      },
      '47': {
        loc: {
          start: {
            line: 492,
            column: 6
          },
          end: {
            line: 492,
            column: 29
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 492,
            column: 24
          },
          end: {
            line: 492,
            column: 29
          }
        }],
        line: 492
      },
      '48': {
        loc: {
          start: {
            line: 493,
            column: 6
          },
          end: {
            line: 493,
            column: 24
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 493,
            column: 19
          },
          end: {
            line: 493,
            column: 24
          }
        }],
        line: 493
      },
      '49': {
        loc: {
          start: {
            line: 495,
            column: 4
          },
          end: {
            line: 500,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 495,
            column: 4
          },
          end: {
            line: 500,
            column: 5
          }
        }, {
          start: {
            line: 495,
            column: 4
          },
          end: {
            line: 500,
            column: 5
          }
        }],
        line: 495
      },
      '50': {
        loc: {
          start: {
            line: 501,
            column: 12
          },
          end: {
            line: 501,
            column: 48
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 501,
            column: 19
          },
          end: {
            line: 501,
            column: 48
          }
        }],
        line: 501
      },
      '51': {
        loc: {
          start: {
            line: 511,
            column: 4
          },
          end: {
            line: 511,
            column: 33
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 511,
            column: 15
          },
          end: {
            line: 511,
            column: 33
          }
        }],
        line: 511
      },
      '52': {
        loc: {
          start: {
            line: 512,
            column: 4
          },
          end: {
            line: 512,
            column: 72
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 512,
            column: 20
          },
          end: {
            line: 512,
            column: 72
          }
        }],
        line: 512
      },
      '53': {
        loc: {
          start: {
            line: 513,
            column: 4
          },
          end: {
            line: 513,
            column: 36
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 513,
            column: 21
          },
          end: {
            line: 513,
            column: 36
          }
        }],
        line: 513
      },
      '54': {
        loc: {
          start: {
            line: 515,
            column: 21
          },
          end: {
            line: 515,
            column: 58
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 515,
            column: 32
          },
          end: {
            line: 515,
            column: 49
          }
        }, {
          start: {
            line: 515,
            column: 52
          },
          end: {
            line: 515,
            column: 58
          }
        }],
        line: 515
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0,
      '51': 0,
      '52': 0,
      '53': 0,
      '54': 0,
      '55': 0,
      '56': 0,
      '57': 0,
      '58': 0,
      '59': 0,
      '60': 0,
      '61': 0,
      '62': 0,
      '63': 0,
      '64': 0,
      '65': 0,
      '66': 0,
      '67': 0,
      '68': 0,
      '69': 0,
      '70': 0,
      '71': 0,
      '72': 0,
      '73': 0,
      '74': 0,
      '75': 0,
      '76': 0,
      '77': 0,
      '78': 0,
      '79': 0,
      '80': 0,
      '81': 0,
      '82': 0,
      '83': 0,
      '84': 0,
      '85': 0,
      '86': 0,
      '87': 0,
      '88': 0,
      '89': 0,
      '90': 0,
      '91': 0,
      '92': 0,
      '93': 0,
      '94': 0,
      '95': 0,
      '96': 0,
      '97': 0,
      '98': 0,
      '99': 0,
      '100': 0,
      '101': 0,
      '102': 0,
      '103': 0,
      '104': 0,
      '105': 0,
      '106': 0,
      '107': 0,
      '108': 0,
      '109': 0,
      '110': 0,
      '111': 0,
      '112': 0,
      '113': 0,
      '114': 0,
      '115': 0,
      '116': 0,
      '117': 0,
      '118': 0,
      '119': 0,
      '120': 0,
      '121': 0,
      '122': 0,
      '123': 0,
      '124': 0,
      '125': 0,
      '126': 0,
      '127': 0,
      '128': 0,
      '129': 0,
      '130': 0,
      '131': 0,
      '132': 0,
      '133': 0,
      '134': 0,
      '135': 0,
      '136': 0,
      '137': 0,
      '138': 0,
      '139': 0,
      '140': 0,
      '141': 0,
      '142': 0,
      '143': 0,
      '144': 0,
      '145': 0,
      '146': 0,
      '147': 0,
      '148': 0,
      '149': 0,
      '150': 0,
      '151': 0,
      '152': 0,
      '153': 0,
      '154': 0,
      '155': 0,
      '156': 0,
      '157': 0,
      '158': 0,
      '159': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0],
      '5': [0],
      '6': [0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0],
      '10': [0],
      '11': [0],
      '12': [0],
      '13': [0],
      '14': [0],
      '15': [0],
      '16': [0],
      '17': [0, 0],
      '18': [0, 0],
      '19': [0, 0],
      '20': [0],
      '21': [0, 0],
      '22': [0],
      '23': [0],
      '24': [0, 0],
      '25': [0, 0],
      '26': [0],
      '27': [0],
      '28': [0, 0],
      '29': [0, 0],
      '30': [0, 0],
      '31': [0, 0],
      '32': [0, 0],
      '33': [0, 0],
      '34': [0, 0],
      '35': [0, 0],
      '36': [0, 0],
      '37': [0, 0],
      '38': [0, 0],
      '39': [0, 0],
      '40': [0, 0],
      '41': [0],
      '42': [0, 0],
      '43': [0, 0],
      '44': [0],
      '45': [0],
      '46': [0, 0],
      '47': [0],
      '48': [0],
      '49': [0, 0],
      '50': [0],
      '51': [0],
      '52': [0],
      '53': [0],
      '54': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}(); /**
      * Tupaia
      * Copyright (c) 2017-2020 Beyond Essential Systems Pty Ltd
      **/

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TupaiaDatabase = exports.JOIN_TYPES = exports.QUERY_CONJUNCTIONS = undefined;

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _entries = require('babel-runtime/core-js/object/entries');

var _entries2 = _interopRequireDefault(_entries);

var _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _getIterator2 = require('babel-runtime/core-js/get-iterator');

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _reactAutobind = require('react-autobind');

var _reactAutobind2 = _interopRequireDefault(_reactAutobind);

var _knex = require('knex');

var _knex2 = _interopRequireDefault(_knex);

var _pgPubsub = require('pg-pubsub');

var _pgPubsub2 = _interopRequireDefault(_pgPubsub);

var _winston = require('winston');

var _winston2 = _interopRequireDefault(_winston);

var _getConnectionConfig = require('./getConnectionConfig');

var _generateId = require('./utilities/generateId');

var _multilock = require('./utilities/multilock');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var QUERY_METHODS = (cov_ifas5nbx0.s[0]++, {
  COUNT: 'count',
  INSERT: 'insert',
  UPDATE: 'update',
  SELECT: 'select',
  DELETE: 'del'
});

var QUERY_CONJUNCTIONS = exports.QUERY_CONJUNCTIONS = (cov_ifas5nbx0.s[1]++, {
  AND: '_and_',
  OR: '_or_',
  RAW: '_raw_'
});

var JOIN_TYPES = exports.JOIN_TYPES = (cov_ifas5nbx0.s[2]++, {
  INNER: 'inner',
  LEFT: 'left',
  LEFT_OUTER: 'leftOuter',
  RIGHT: 'right',
  RIGHT_OUTER: 'rightOuter',
  OUTER: 'outer',
  FULL_OUTER: 'fullOuter',
  CROSS: 'cross',
  DEFAULT: null
});

// no math here, just hand-tuned to be as low as possible while
// keeping all the tests passing
var HANDLER_DEBOUNCE_DURATION = (cov_ifas5nbx0.s[3]++, 250);

var TupaiaDatabase = exports.TupaiaDatabase = function () {
  function TupaiaDatabase(transactingConnection) {
    var _this = this;

    (0, _classCallCheck3.default)(this, TupaiaDatabase);
    cov_ifas5nbx0.f[0]++;
    cov_ifas5nbx0.s[4]++;

    (0, _reactAutobind2.default)(this);
    cov_ifas5nbx0.s[5]++;
    this.changeHandlers = {};

    // If this instance is not for a specific transaction, it is the singleton instance
    cov_ifas5nbx0.s[6]++;
    this.isSingleton = !transactingConnection;

    cov_ifas5nbx0.s[7]++;
    var connectToDatabase = function () {
      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
        return _regenerator2.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                cov_ifas5nbx0.f[1]++;
                cov_ifas5nbx0.s[8]++;
                _context.t0 = (cov_ifas5nbx0.b[0][0]++, transactingConnection);

                if (_context.t0) {
                  _context.next = 8;
                  break;
                }

                cov_ifas5nbx0.b[0][1]++;
                _context.next = 7;
                return (0, _knex2.default)({
                  client: 'pg',
                  connection: (0, _getConnectionConfig.getConnectionConfig)()
                });

              case 7:
                _context.t0 = _context.sent;

              case 8:
                _this.connection = _context.t0;
                cov_ifas5nbx0.s[9]++;

                if (_this.isSingleton) {
                  cov_ifas5nbx0.b[1][0]++;
                  cov_ifas5nbx0.s[10]++;

                  _this.changeListener = new _pgPubsub2.default((0, _getConnectionConfig.getConnectionConfig)());
                  cov_ifas5nbx0.s[11]++;
                  _this.changeListener.addChannel('change', _this.notifyChangeHandlers);
                } else {
                  cov_ifas5nbx0.b[1][1]++;
                }
                cov_ifas5nbx0.s[12]++;
                return _context.abrupt('return', true);

              case 13:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, _this);
      }));

      return function connectToDatabase() {
        return _ref.apply(this, arguments);
      };
    }();
    cov_ifas5nbx0.s[13]++;
    this.connectionPromise = connectToDatabase();

    cov_ifas5nbx0.s[14]++;
    this.handlerLock = new _multilock.Multilock();
  }

  (0, _createClass3.default)(TupaiaDatabase, [{
    key: 'destroy',
    value: function destroy() {
      cov_ifas5nbx0.f[2]++;
      cov_ifas5nbx0.s[15]++;

      this.changeListener.close();
      cov_ifas5nbx0.s[16]++;
      this.connection.destroy();
    }
  }, {
    key: 'addChangeHandlerForCollection',
    value: function addChangeHandlerForCollection(collectionName, changeHandler) {
      cov_ifas5nbx0.f[3]++;
      cov_ifas5nbx0.s[17]++;

      this.getChangeHandlersForCollection(collectionName).push(changeHandler);
    }
  }, {
    key: 'notifyChangeHandlers',
    value: function () {
      var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(_ref3) {
        var change = _ref3.change,
            record = _ref3.record;
        var unlock, changeHandlersForCollection, i;
        return _regenerator2.default.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                cov_ifas5nbx0.f[4]++;
                unlock = (cov_ifas5nbx0.s[18]++, this.handlerLock.createLock(change.record_id));
                cov_ifas5nbx0.s[19]++;
                _context2.prev = 3;
                changeHandlersForCollection = (cov_ifas5nbx0.s[20]++, this.getChangeHandlersForCollection(change.record_type));
                cov_ifas5nbx0.s[21]++;
                i = 0;

              case 7:
                if (!(i < changeHandlersForCollection.length)) {
                  _context2.next = 22;
                  break;
                }

                cov_ifas5nbx0.s[22]++;
                _context2.prev = 9;
                cov_ifas5nbx0.s[23]++;
                _context2.next = 13;
                return changeHandlersForCollection[i](change, record);

              case 13:
                _context2.next = 19;
                break;

              case 15:
                _context2.prev = 15;
                _context2.t0 = _context2['catch'](9);
                cov_ifas5nbx0.s[24]++;

                _winston2.default.error(_context2.t0);

              case 19:
                i++;
                _context2.next = 7;
                break;

              case 22:
                _context2.prev = 22;
                cov_ifas5nbx0.s[25]++;

                unlock();
                return _context2.finish(22);

              case 26:
              case 'end':
                return _context2.stop();
            }
          }
        }, _callee2, this, [[3,, 22, 26], [9, 15]]);
      }));

      function notifyChangeHandlers(_x) {
        return _ref2.apply(this, arguments);
      }

      return notifyChangeHandlers;
    }()
  }, {
    key: 'waitForAllChangeHandlers',
    value: function () {
      var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
        return _regenerator2.default.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                cov_ifas5nbx0.f[5]++;
                cov_ifas5nbx0.s[26]++;
                return _context3.abrupt('return', this.handlerLock.waitWithDebounce(HANDLER_DEBOUNCE_DURATION));

              case 3:
              case 'end':
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function waitForAllChangeHandlers() {
        return _ref4.apply(this, arguments);
      }

      return waitForAllChangeHandlers;
    }()
  }, {
    key: 'getChangeHandlersForCollection',
    value: function getChangeHandlersForCollection(collectionName) {
      cov_ifas5nbx0.f[6]++;
      cov_ifas5nbx0.s[27]++;

      // Instantiate the array if no change handlers currently exist for the collection
      if (!this.changeHandlers[collectionName]) {
        cov_ifas5nbx0.b[2][0]++;
        cov_ifas5nbx0.s[28]++;

        this.changeHandlers[collectionName] = [];
      } else {
        cov_ifas5nbx0.b[2][1]++;
      }
      cov_ifas5nbx0.s[29]++;
      return this.changeHandlers[collectionName];
    }
  }, {
    key: 'wrapInTransaction',
    value: function wrapInTransaction(wrappedFunction) {
      cov_ifas5nbx0.f[7]++;
      cov_ifas5nbx0.s[30]++;

      return this.connection.transaction(function (transaction) {
        cov_ifas5nbx0.f[8]++;
        cov_ifas5nbx0.s[31]++;
        return wrappedFunction(new TupaiaDatabase(transaction));
      });
    }
  }, {
    key: 'fetchSchemaForTable',
    value: function () {
      var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(databaseType) {
        return _regenerator2.default.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                cov_ifas5nbx0.f[9]++;
                cov_ifas5nbx0.s[32]++;
                _context4.next = 4;
                return this.connectionPromise;

              case 4:
                cov_ifas5nbx0.s[33]++;
                return _context4.abrupt('return', this.connection(databaseType).columnInfo());

              case 6:
              case 'end':
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function fetchSchemaForTable(_x2) {
        return _ref5.apply(this, arguments);
      }

      return fetchSchemaForTable;
    }()

    /**
     * Builds a query on the database, which can be awaited to reveal the result.
     * Implementation notes: If the connection is available, it will return the knex built query
     * without a wrapping Promise. This is necessary for nested queries to function correctly. If the
     * connection is not yet available, it will await the connection, so necessarily return the built
     * query inside a wrapped promise. This Promise-wrapped query can still be awaited as normal to
     * reveal a result, but cannot be passed back in as an innerQuery during nesting. So there is a
     * small and very rare hole whereby if on first starting the server, the connection is pending and
     * someone runs a nested query, it will crash.
     */

  }, {
    key: 'query',
    value: function query() {
      cov_ifas5nbx0.f[10]++;
      cov_ifas5nbx0.s[34]++;

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      if (!this.connection) {
        cov_ifas5nbx0.b[3][0]++;
        cov_ifas5nbx0.s[35]++;

        // If not yet connected, wait until we are, then run the query
        return this.queryWhenConnected.apply(this, args);
      } else {
        cov_ifas5nbx0.b[3][1]++;
      }
      // We are already connected, query immediately
      cov_ifas5nbx0.s[36]++;
      return buildQuery.apply(undefined, [this.connection].concat(args));
    }

    /**
     * Asynchronously await the database connection to be made, and then build the query as per normal
     */

  }, {
    key: 'queryWhenConnected',
    value: function () {
      var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5() {
        for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
          args[_key2] = arguments[_key2];
        }

        return _regenerator2.default.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                cov_ifas5nbx0.f[11]++;
                cov_ifas5nbx0.s[37]++;
                _context5.next = 4;
                return this.connectionPromise;

              case 4:
                cov_ifas5nbx0.s[38]++;
                return _context5.abrupt('return', buildQuery.apply(undefined, [this.connection].concat(args)));

              case 6:
              case 'end':
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function queryWhenConnected() {
        return _ref6.apply(this, arguments);
      }

      return queryWhenConnected;
    }()
  }, {
    key: 'find',
    value: function find(recordType) {
      var where = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : (cov_ifas5nbx0.b[4][0]++, {});
      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (cov_ifas5nbx0.b[5][0]++, {});
      var queryMethod = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : (cov_ifas5nbx0.b[6][0]++, QUERY_METHODS.SELECT);
      cov_ifas5nbx0.f[12]++;
      cov_ifas5nbx0.s[39]++;

      if (options.subQuery) {
        cov_ifas5nbx0.b[7][0]++;

        var _ref7 = (cov_ifas5nbx0.s[40]++, options.subQuery),
            subRecordType = _ref7.recordType,
            subWhere = _ref7.where,
            subOptions = (0, _objectWithoutProperties3.default)(_ref7, ['recordType', 'where']);

        cov_ifas5nbx0.s[41]++;

        options.innerQuery = this.find(subRecordType, subWhere, subOptions);
      } else {
        cov_ifas5nbx0.b[7][1]++;
      }
      cov_ifas5nbx0.s[42]++;
      return this.query({
        recordType: recordType,
        queryMethod: queryMethod
      }, where, options);
    }
  }, {
    key: 'findOne',
    value: function () {
      var _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6(recordType, where, options) {
        var results;
        return _regenerator2.default.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                cov_ifas5nbx0.f[13]++;
                cov_ifas5nbx0.s[43]++;
                _context6.next = 4;
                return this.find(recordType, where, (0, _extends3.default)({}, options, { limit: 1 }));

              case 4:
                results = _context6.sent;
                cov_ifas5nbx0.s[44]++;
                return _context6.abrupt('return', (cov_ifas5nbx0.b[9][0]++, results) && (cov_ifas5nbx0.b[9][1]++, results.length > 0) ? (cov_ifas5nbx0.b[8][0]++, results[0]) : (cov_ifas5nbx0.b[8][1]++, null));

              case 7:
              case 'end':
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));

      function findOne(_x6, _x7, _x8) {
        return _ref8.apply(this, arguments);
      }

      return findOne;
    }()
  }, {
    key: 'findById',
    value: function findById(recordType, id, options) {
      cov_ifas5nbx0.f[14]++;
      cov_ifas5nbx0.s[45]++;

      return this.findOne(recordType, { id: id }, options);
    }
  }, {
    key: 'findRecursiveTree',
    value: function () {
      var _ref9 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7(recordType, id) {
        var idKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (cov_ifas5nbx0.b[10][0]++, 'id');
        var parentIdKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : (cov_ifas5nbx0.b[11][0]++, 'parent_id');
        var sql;
        return _regenerator2.default.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                cov_ifas5nbx0.f[15]++;

                // See https://stackoverflow.com/questions/34954873/get-entire-hierarchy-of-parents-from-a-given-child-in-postgresql
                sql = (cov_ifas5nbx0.s[46]++, '\n     with recursive findParents as (\n       select * from ' + recordType + '\n         where ' + idKey + ' = \'' + id + '\'\n       union\n         select ' + recordType + '.* from ' + recordType + '\n           join findParents on findParents.' + parentIdKey + ' = ' + recordType + '.' + idKey + '\n     )\n\n     select * from findParents;\n   ');
                cov_ifas5nbx0.s[47]++;
                return _context7.abrupt('return', this.executeSql(sql));

              case 4:
              case 'end':
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function findRecursiveTree(_x9, _x10) {
        return _ref9.apply(this, arguments);
      }

      return findRecursiveTree;
    }()
  }, {
    key: 'findWithParents',
    value: function () {
      var _ref10 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8(recordType, id) {
        var idKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (cov_ifas5nbx0.b[12][0]++, 'id');
        var parentIdKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : (cov_ifas5nbx0.b[13][0]++, 'parent_id');
        return _regenerator2.default.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                cov_ifas5nbx0.f[16]++;
                cov_ifas5nbx0.s[48]++;
                return _context8.abrupt('return', this.findRecursiveTree(recordType, id, idKey, parentIdKey));

              case 3:
              case 'end':
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function findWithParents(_x13, _x14) {
        return _ref10.apply(this, arguments);
      }

      return findWithParents;
    }()
  }, {
    key: 'findWithChildren',
    value: function () {
      var _ref11 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee9(recordType, id) {
        var idKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (cov_ifas5nbx0.b[14][0]++, 'id');
        var parentIdKey = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : (cov_ifas5nbx0.b[15][0]++, 'parent_id');
        return _regenerator2.default.wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                cov_ifas5nbx0.f[17]++;
                cov_ifas5nbx0.s[49]++;
                return _context9.abrupt('return', this.findRecursiveTree(recordType, id, parentIdKey, idKey));

              case 3:
              case 'end':
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function findWithChildren(_x17, _x18) {
        return _ref11.apply(this, arguments);
      }

      return findWithChildren;
    }()
  }, {
    key: 'findOrCreate',
    value: function () {
      var _ref12 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee10(recordType, where) {
        var extraFieldsIfCreating = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (cov_ifas5nbx0.b[16][0]++, {});
        var record;
        return _regenerator2.default.wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                cov_ifas5nbx0.f[18]++;
                cov_ifas5nbx0.s[50]++;
                _context10.next = 4;
                return this.findOne(recordType, where);

              case 4:
                record = _context10.sent;
                cov_ifas5nbx0.s[51]++;
                return _context10.abrupt('return', (cov_ifas5nbx0.b[17][0]++, record) || (cov_ifas5nbx0.b[17][1]++, this.create(recordType, (0, _extends3.default)({}, where, extraFieldsIfCreating))));

              case 7:
              case 'end':
                return _context10.stop();
            }
          }
        }, _callee10, this);
      }));

      function findOrCreate(_x21, _x22) {
        return _ref12.apply(this, arguments);
      }

      return findOrCreate;
    }()
  }, {
    key: 'count',
    value: function () {
      var _ref13 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee11(recordType, where, options) {
        var result;
        return _regenerator2.default.wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                cov_ifas5nbx0.f[19]++;
                cov_ifas5nbx0.s[52]++;
                _context11.next = 4;
                return this.find(recordType, where, options, QUERY_METHODS.COUNT);

              case 4:
                result = _context11.sent;
                cov_ifas5nbx0.s[53]++;
                return _context11.abrupt('return', parseInt(result[0].count, 10));

              case 7:
              case 'end':
                return _context11.stop();
            }
          }
        }, _callee11, this);
      }));

      function count(_x24, _x25, _x26) {
        return _ref13.apply(this, arguments);
      }

      return count;
    }()
  }, {
    key: 'create',
    value: function () {
      var _ref14 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee12(recordType, record) {
        for (var _len3 = arguments.length, additionalRecords = Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {
          additionalRecords[_key3 - 2] = arguments[_key3];
        }

        var recordsCreated, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, additionalRecord, recordCreated;

        return _regenerator2.default.wrap(function _callee12$(_context12) {
          while (1) {
            switch (_context12.prev = _context12.next) {
              case 0:
                cov_ifas5nbx0.f[20]++;
                cov_ifas5nbx0.s[54]++;

                // TODO could be more efficient to put all extra objects into one query
                if (!record.id) {
                  cov_ifas5nbx0.b[18][0]++;
                  cov_ifas5nbx0.s[55]++;

                  record.id = (0, _generateId.generateId)();
                } else {
                  cov_ifas5nbx0.b[18][1]++;
                }
                cov_ifas5nbx0.s[56]++;
                _context12.next = 6;
                return this.query({
                  recordType: recordType,
                  queryMethod: QUERY_METHODS.INSERT,
                  queryMethodParameter: record
                });

              case 6:
                cov_ifas5nbx0.s[57]++;

                if (!(additionalRecords.length === 0)) {
                  _context12.next = 13;
                  break;
                }

                cov_ifas5nbx0.b[19][0]++;
                cov_ifas5nbx0.s[58]++;
                return _context12.abrupt('return', record);

              case 13:
                cov_ifas5nbx0.b[19][1]++;

              case 14:
                recordsCreated = (cov_ifas5nbx0.s[59]++, [record]);
                cov_ifas5nbx0.s[60]++;
                _iteratorNormalCompletion = true;
                _didIteratorError = false;
                _iteratorError = undefined;
                _context12.prev = 19;
                _iterator = (0, _getIterator3.default)(additionalRecords);

              case 21:
                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {
                  _context12.next = 32;
                  break;
                }

                additionalRecord = _step.value;
                cov_ifas5nbx0.s[61]++;
                _context12.next = 26;
                return this.create(recordType, additionalRecord);

              case 26:
                recordCreated = _context12.sent;
                cov_ifas5nbx0.s[62]++;

                recordsCreated.push(recordCreated);

              case 29:
                _iteratorNormalCompletion = true;
                _context12.next = 21;
                break;

              case 32:
                _context12.next = 38;
                break;

              case 34:
                _context12.prev = 34;
                _context12.t0 = _context12['catch'](19);
                _didIteratorError = true;
                _iteratorError = _context12.t0;

              case 38:
                _context12.prev = 38;
                _context12.prev = 39;

                if (!_iteratorNormalCompletion && _iterator.return) {
                  _iterator.return();
                }

              case 41:
                _context12.prev = 41;

                if (!_didIteratorError) {
                  _context12.next = 44;
                  break;
                }

                throw _iteratorError;

              case 44:
                return _context12.finish(41);

              case 45:
                return _context12.finish(38);

              case 46:
                cov_ifas5nbx0.s[63]++;
                return _context12.abrupt('return', recordsCreated);

              case 48:
              case 'end':
                return _context12.stop();
            }
          }
        }, _callee12, this, [[19, 34, 38, 46], [39,, 41, 45]]);
      }));

      function create(_x27, _x28) {
        return _ref14.apply(this, arguments);
      }

      return create;
    }()

    /**
     * Updates all records that match the criteria to have the values in updatedFields
     * @param {string} recordType     Records of this type will be updated
     * @param {object} where          Records matching this criteria will be updated
     * @param {object} updatedFields  The new values that should be in the record
     */

  }, {
    key: 'update',
    value: function () {
      var _ref15 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee13(recordType, where, updatedFields) {
        return _regenerator2.default.wrap(function _callee13$(_context13) {
          while (1) {
            switch (_context13.prev = _context13.next) {
              case 0:
                cov_ifas5nbx0.f[21]++;
                cov_ifas5nbx0.s[64]++;
                return _context13.abrupt('return', this.query({
                  recordType: recordType,
                  queryMethod: QUERY_METHODS.UPDATE,
                  queryMethodParameter: updatedFields
                }, where));

              case 3:
              case 'end':
                return _context13.stop();
            }
          }
        }, _callee13, this);
      }));

      function update(_x29, _x30, _x31) {
        return _ref15.apply(this, arguments);
      }

      return update;
    }()
  }, {
    key: 'updateById',
    value: function () {
      var _ref16 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee14(recordType, id, updatedFields) {
        return _regenerator2.default.wrap(function _callee14$(_context14) {
          while (1) {
            switch (_context14.prev = _context14.next) {
              case 0:
                cov_ifas5nbx0.f[22]++;
                cov_ifas5nbx0.s[65]++;
                return _context14.abrupt('return', this.update(recordType, { id: id }, updatedFields));

              case 3:
              case 'end':
                return _context14.stop();
            }
          }
        }, _callee14, this);
      }));

      function updateById(_x32, _x33, _x34) {
        return _ref16.apply(this, arguments);
      }

      return updateById;
    }()
  }, {
    key: 'updateOrCreate',
    value: function () {
      var _ref17 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee15(recordType, identifiers, updatedFields) {
        var newId, updatedFieldsWithoutUndefined, newRecord, buildQueryList, columns, values, conflict, updates, allParameterBindings, result;
        return _regenerator2.default.wrap(function _callee15$(_context15) {
          while (1) {
            switch (_context15.prev = _context15.next) {
              case 0:
                cov_ifas5nbx0.f[23]++;

                // Put together the full new record that will be created, if no matching record exists
                newId = (cov_ifas5nbx0.s[66]++, (0, _generateId.generateId)()); // Generate a new id, in no id was provided

                updatedFieldsWithoutUndefined = (cov_ifas5nbx0.s[67]++, JSON.parse((0, _stringify2.default)(updatedFields)));
                newRecord = (cov_ifas5nbx0.s[68]++, (0, _extends3.default)({ id: newId }, identifiers, updatedFieldsWithoutUndefined));
                cov_ifas5nbx0.s[69]++;

                buildQueryList = function buildQueryList(object, formatter) {
                  cov_ifas5nbx0.f[24]++;
                  cov_ifas5nbx0.s[70]++;
                  return (0, _keys2.default)(object).map(formatter).join(',');
                };

                // Build string of all column names to be inserted on new record creation


                columns = (cov_ifas5nbx0.s[71]++, buildQueryList(newRecord, function (columnName) {
                  cov_ifas5nbx0.f[25]++;
                  cov_ifas5nbx0.s[72]++;
                  return ':old_column_' + columnName + ':';
                }));

                // Build string of all values to be inserted on new record creation

                values = (cov_ifas5nbx0.s[73]++, buildQueryList(newRecord, function (columnName) {
                  cov_ifas5nbx0.f[26]++;
                  cov_ifas5nbx0.s[74]++;
                  return ':' + columnName;
                }));

                // Build string of column names to detect a conflict on, i.e. the identifying columns

                conflict = (cov_ifas5nbx0.s[75]++, buildQueryList(identifiers, function (columnName) {
                  cov_ifas5nbx0.f[27]++;
                  cov_ifas5nbx0.s[76]++;
                  return ':old_column_' + columnName + ':';
                }));

                // Build string of just those fields to update if a matching record exists

                updates = (cov_ifas5nbx0.s[77]++, buildQueryList(updatedFieldsWithoutUndefined, function (columnName) {
                  cov_ifas5nbx0.f[28]++;
                  cov_ifas5nbx0.s[78]++;
                  return ':old_column_' + columnName + ': = :new_column_' + columnName + ':';
                }));

                // Put together all parameters that may need to be bound, including the column names and values

                allParameterBindings = (cov_ifas5nbx0.s[79]++, (0, _extends3.default)({
                  recordType: recordType
                }, newRecord));
                cov_ifas5nbx0.s[80]++;

                (0, _keys2.default)(newRecord).forEach(function (columnName) {
                  cov_ifas5nbx0.f[29]++;
                  cov_ifas5nbx0.s[81]++;

                  allParameterBindings['old_column_' + columnName] = columnName; // Use 'old_column_' prefix
                });
                cov_ifas5nbx0.s[82]++;
                (0, _keys2.default)(updatedFieldsWithoutUndefined).forEach(function (columnName) {
                  cov_ifas5nbx0.f[30]++;
                  cov_ifas5nbx0.s[83]++;

                  // If updating on conflict, we can use the special postgres "excluded" table name to refer to
                  // the record that failed to be inserted. Use 'new_column_' as the prefix
                  allParameterBindings['new_column_' + columnName] = 'excluded.' + columnName;
                });

                // Run the sql
                cov_ifas5nbx0.s[84]++;
                _context15.next = 18;
                return this.executeSql('\n        INSERT INTO :recordType: (' + columns + ')\n          VALUES (' + values + ')\n          ON CONFLICT (' + conflict + ') DO UPDATE\n            SET ' + updates + '\n          RETURNING *;\n      ', allParameterBindings);

              case 18:
                result = _context15.sent;
                cov_ifas5nbx0.s[85]++;
                return _context15.abrupt('return', result[0]);

              case 21:
              case 'end':
                return _context15.stop();
            }
          }
        }, _callee15, this);
      }));

      function updateOrCreate(_x35, _x36, _x37) {
        return _ref17.apply(this, arguments);
      }

      return updateOrCreate;
    }()
  }, {
    key: 'delete',
    value: function () {
      var _ref18 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee16(recordType) {
        var where = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : (cov_ifas5nbx0.b[20][0]++, {});
        return _regenerator2.default.wrap(function _callee16$(_context16) {
          while (1) {
            switch (_context16.prev = _context16.next) {
              case 0:
                cov_ifas5nbx0.f[31]++;
                cov_ifas5nbx0.s[86]++;
                return _context16.abrupt('return', this.query({
                  recordType: recordType,
                  queryMethod: QUERY_METHODS.DELETE
                }, where));

              case 3:
              case 'end':
                return _context16.stop();
            }
          }
        }, _callee16, this);
      }));

      function _delete(_x38) {
        return _ref18.apply(this, arguments);
      }

      return _delete;
    }()
  }, {
    key: 'deleteById',
    value: function () {
      var _ref19 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee17(recordType, id) {
        return _regenerator2.default.wrap(function _callee17$(_context17) {
          while (1) {
            switch (_context17.prev = _context17.next) {
              case 0:
                cov_ifas5nbx0.f[32]++;
                cov_ifas5nbx0.s[87]++;
                return _context17.abrupt('return', this.delete(recordType, { id: id }));

              case 3:
              case 'end':
                return _context17.stop();
            }
          }
        }, _callee17, this);
      }));

      function deleteById(_x40, _x41) {
        return _ref19.apply(this, arguments);
      }

      return deleteById;
    }()

    /**
     * Force a change to be recorded against the records matching the search criteria, and return
     * those records.
     */

  }, {
    key: 'markAsChanged',
    value: function () {
      var _ref20 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee18(recordType, where, options) {
        var records, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, record;

        return _regenerator2.default.wrap(function _callee18$(_context18) {
          while (1) {
            switch (_context18.prev = _context18.next) {
              case 0:
                cov_ifas5nbx0.f[33]++;
                cov_ifas5nbx0.s[88]++;
                _context18.next = 4;
                return this.find(recordType, where, options);

              case 4:
                records = _context18.sent;
                cov_ifas5nbx0.s[89]++;
                _iteratorNormalCompletion2 = true;
                _didIteratorError2 = false;
                _iteratorError2 = undefined;
                _context18.prev = 9;

                for (_iterator2 = (0, _getIterator3.default)(records); !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                  record = _step2.value;
                  cov_ifas5nbx0.s[90]++;

                  this.changeListener.publish('change', {
                    change: {
                      record_id: record.id,
                      type: 'update',
                      record_type: recordType
                    },
                    record: record
                  });
                }
                _context18.next = 17;
                break;

              case 13:
                _context18.prev = 13;
                _context18.t0 = _context18['catch'](9);
                _didIteratorError2 = true;
                _iteratorError2 = _context18.t0;

              case 17:
                _context18.prev = 17;
                _context18.prev = 18;

                if (!_iteratorNormalCompletion2 && _iterator2.return) {
                  _iterator2.return();
                }

              case 20:
                _context18.prev = 20;

                if (!_didIteratorError2) {
                  _context18.next = 23;
                  break;
                }

                throw _iteratorError2;

              case 23:
                return _context18.finish(20);

              case 24:
                return _context18.finish(17);

              case 25:
                cov_ifas5nbx0.s[91]++;
                return _context18.abrupt('return', records);

              case 27:
              case 'end':
                return _context18.stop();
            }
          }
        }, _callee18, this, [[9, 13, 17, 25], [18,, 20, 24]]);
      }));

      function markAsChanged(_x42, _x43, _x44) {
        return _ref20.apply(this, arguments);
      }

      return markAsChanged;
    }()
  }, {
    key: 'getSetting',
    value: function () {
      var _ref21 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee19(key) {
        var setting;
        return _regenerator2.default.wrap(function _callee19$(_context19) {
          while (1) {
            switch (_context19.prev = _context19.next) {
              case 0:
                cov_ifas5nbx0.f[34]++;
                cov_ifas5nbx0.s[92]++;
                _context19.next = 4;
                return this.findOne('setting', { key: key });

              case 4:
                setting = _context19.sent;
                cov_ifas5nbx0.s[93]++;
                return _context19.abrupt('return', setting ? (cov_ifas5nbx0.b[21][0]++, setting.value) : (cov_ifas5nbx0.b[21][1]++, null));

              case 7:
              case 'end':
                return _context19.stop();
            }
          }
        }, _callee19, this);
      }));

      function getSetting(_x45) {
        return _ref21.apply(this, arguments);
      }

      return getSetting;
    }()
  }, {
    key: 'setSetting',
    value: function setSetting(key, value) {
      cov_ifas5nbx0.f[35]++;
      cov_ifas5nbx0.s[94]++;

      return this.updateOrCreate('setting', { key: key }, { value: value });
    }
  }, {
    key: 'clearSetting',
    value: function clearSetting(key) {
      cov_ifas5nbx0.f[36]++;
      cov_ifas5nbx0.s[95]++;

      return this.delete('setting', { key: key });
    }

    /**
     * Execute a sum query.
     *
     * eg:
     * this.database.sum('user_reward', ['pigs', 'coconuts'], {
     *   user_id: userId,
     * });
     * could return:
     * { coconuts: 99, pigs: 55 }
     *
     * @param {string} table
     * Database table to sum from.
     * @param {array} fields
     * An array of fields to sum.
     * @param {object} where
     * Conditions for the sum query.
     */

  }, {
    key: 'sum',
    value: function () {
      var _ref22 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee20(table) {
        var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : (cov_ifas5nbx0.b[22][0]++, []);
        var where = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (cov_ifas5nbx0.b[23][0]++, {});
        var query, result, processedResult;
        return _regenerator2.default.wrap(function _callee20$(_context20) {
          while (1) {
            switch (_context20.prev = _context20.next) {
              case 0:
                cov_ifas5nbx0.f[37]++;
                cov_ifas5nbx0.s[96]++;

                if (this.connection) {
                  _context20.next = 9;
                  break;
                }

                cov_ifas5nbx0.b[24][0]++;
                cov_ifas5nbx0.s[97]++;
                _context20.next = 7;
                return this.connectionPromise;

              case 7:
                _context20.next = 10;
                break;

              case 9:
                cov_ifas5nbx0.b[24][1]++;

              case 10:
                query = (cov_ifas5nbx0.s[98]++, this.connection(table));
                cov_ifas5nbx0.s[99]++;


                fields.forEach(function (fieldToSum) {
                  cov_ifas5nbx0.f[38]++;
                  cov_ifas5nbx0.s[100]++;

                  query.sum(fieldToSum + ' as ' + fieldToSum);
                });

                cov_ifas5nbx0.s[101]++;
                _context20.next = 16;
                return query.where(where);

              case 16:
                result = _context20.sent;
                processedResult = (cov_ifas5nbx0.s[102]++, {});

                // Convert counts to integers.

                cov_ifas5nbx0.s[103]++;
                (0, _keys2.default)(result[0]).forEach(function (sumKey) {
                  cov_ifas5nbx0.f[39]++;
                  cov_ifas5nbx0.s[104]++;

                  processedResult[sumKey] = parseInt(result[0][sumKey], 10);
                });

                cov_ifas5nbx0.s[105]++;
                return _context20.abrupt('return', processedResult);

              case 22:
              case 'end':
                return _context20.stop();
            }
          }
        }, _callee20, this);
      }));

      function sum(_x46) {
        return _ref22.apply(this, arguments);
      }

      return sum;
    }()

    /**
     * Runs an arbitrary SQL query against the database.
     *
     * Use only for situations in which Knex is not able to assemble a query.
     */

  }, {
    key: 'executeSql',
    value: function () {
      var _ref23 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee21(sqlString, parametersToBind) {
        var result;
        return _regenerator2.default.wrap(function _callee21$(_context21) {
          while (1) {
            switch (_context21.prev = _context21.next) {
              case 0:
                cov_ifas5nbx0.f[40]++;
                cov_ifas5nbx0.s[106]++;

                if (this.connection) {
                  _context21.next = 9;
                  break;
                }

                cov_ifas5nbx0.b[25][0]++;
                cov_ifas5nbx0.s[107]++;
                _context21.next = 7;
                return this.connectionPromise;

              case 7:
                _context21.next = 10;
                break;

              case 9:
                cov_ifas5nbx0.b[25][1]++;

              case 10:
                cov_ifas5nbx0.s[108]++;
                _context21.next = 13;
                return this.connection.raw(sqlString, parametersToBind);

              case 13:
                result = _context21.sent;
                cov_ifas5nbx0.s[109]++;
                return _context21.abrupt('return', result.rows);

              case 16:
              case 'end':
                return _context21.stop();
            }
          }
        }, _callee21, this);
      }));

      function executeSql(_x49, _x50) {
        return _ref23.apply(this, arguments);
      }

      return executeSql;
    }()
  }]);
  return TupaiaDatabase;
}();

/**
 * Builds the query specified by the parameters passed in. The returned query can either be
 * 'awaited' (in which case it will execute and return the result), or passed back in to
 * this.query as part of a nested query.
 */


function buildQuery(connection, queryConfig) {
  var where = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (cov_ifas5nbx0.b[26][0]++, {});
  var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : (cov_ifas5nbx0.b[27][0]++, {});
  cov_ifas5nbx0.f[41]++;

  var _ref24 = (cov_ifas5nbx0.s[110]++, queryConfig),
      recordType = _ref24.recordType,
      queryMethod = _ref24.queryMethod,
      queryMethodParameter = _ref24.queryMethodParameter;

  var query = (cov_ifas5nbx0.s[111]++, connection(recordType)); // Query starts as just the table, but will be built up

  // If an innerQuery is defined, make the outer query wrap it
  cov_ifas5nbx0.s[112]++;
  if (options.innerQuery) {
    cov_ifas5nbx0.b[28][0]++;
    cov_ifas5nbx0.s[113]++;

    query = query.from(options.innerQuery);
  } else {
    cov_ifas5nbx0.b[28][1]++;
  }

  // Add join options if provided
  cov_ifas5nbx0.s[114]++;
  if (options.joinWith) {
    cov_ifas5nbx0.b[29][0]++;
    cov_ifas5nbx0.s[115]++;

    query = addJoin(query, recordType, options);
  } else {
    cov_ifas5nbx0.b[29][1]++;
  }

  // Add multiple join options if provided
  cov_ifas5nbx0.s[116]++;
  if (options.multiJoin) {
    cov_ifas5nbx0.b[30][0]++;
    cov_ifas5nbx0.s[117]++;

    options.multiJoin.forEach(function (joinOptions) {
      cov_ifas5nbx0.f[42]++;
      cov_ifas5nbx0.s[118]++;
      return query = addJoin(query, recordType, joinOptions);
    });
  } else {
    cov_ifas5nbx0.b[30][1]++;
  }

  // Add filtering (or WHERE) details if provided
  cov_ifas5nbx0.s[119]++;
  query = addWhereClause(query[queryMethod]((cov_ifas5nbx0.b[31][0]++, queryMethodParameter) || (cov_ifas5nbx0.b[31][1]++, options.columns)), where);

  // Add sorting information if provided
  cov_ifas5nbx0.s[120]++;
  if (options.sort) {
    cov_ifas5nbx0.b[32][0]++;
    cov_ifas5nbx0.s[121]++;
    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = (0, _getIterator3.default)(options.sort), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        var sortKey = _step3.value;

        var _ref25 = (cov_ifas5nbx0.s[122]++, sortKey.split(' ')),
            _ref26 = (0, _slicedToArray3.default)(_ref25, 2),
            columnName = _ref26[0],
            direction = _ref26[1];

        cov_ifas5nbx0.s[123]++;

        query = query.orderBy(columnName, direction);
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }
  } else {
    cov_ifas5nbx0.b[32][1]++;
  }

  // Restrict the number of rows returned if limit provided
  cov_ifas5nbx0.s[124]++;
  if (options.limit) {
    cov_ifas5nbx0.b[33][0]++;
    cov_ifas5nbx0.s[125]++;

    query = query.limit(options.limit);
  } else {
    cov_ifas5nbx0.b[33][1]++;
  }

  // Allow results to be returned offset for pagination
  cov_ifas5nbx0.s[126]++;
  if (options.offset) {
    cov_ifas5nbx0.b[34][0]++;
    cov_ifas5nbx0.s[127]++;

    query = query.offset(options.offset);
  } else {
    cov_ifas5nbx0.b[34][1]++;
  }

  // Alias the query result (for use in nested queries) if name provided
  cov_ifas5nbx0.s[128]++;
  if (options.name) {
    cov_ifas5nbx0.b[35][0]++;
    cov_ifas5nbx0.s[129]++;

    query = query.as(options.name);
  } else {
    cov_ifas5nbx0.b[35][1]++;
  }

  cov_ifas5nbx0.s[130]++;
  if (queryMethod === QUERY_METHODS.UPDATE) {
    cov_ifas5nbx0.b[36][0]++;
    cov_ifas5nbx0.s[131]++;

    // Return all fields after
    query.returning('*');
  } else {
    cov_ifas5nbx0.b[36][1]++;
  }

  // Now constructed, the query can either be 'awaited' (in which case it will execute and return
  // the result), or passed back in to this.query as part of a nested query.
  cov_ifas5nbx0.s[132]++;
  return query;
}

function addWhereClause(baseQuery, where) {
  cov_ifas5nbx0.f[43]++;
  cov_ifas5nbx0.s[133]++;

  if (!where) {
    cov_ifas5nbx0.b[37][0]++;
    cov_ifas5nbx0.s[134]++;

    return baseQuery;
  } else {
    cov_ifas5nbx0.b[37][1]++;
  }
  cov_ifas5nbx0.s[135]++;
  return (0, _entries2.default)(where).reduce(function (querySoFar, _ref27) {
    var _ref28 = (0, _slicedToArray3.default)(_ref27, 2),
        key = _ref28[0],
        value = _ref28[1];

    cov_ifas5nbx0.f[44]++;
    cov_ifas5nbx0.s[136]++;

    // Providing the _and_ or the _or_ keys will use the contained criteria as a bracket wrapped
    // subsection of the broader WHERE clause
    if (key === QUERY_CONJUNCTIONS.AND) {
      cov_ifas5nbx0.b[38][0]++;
      cov_ifas5nbx0.s[137]++;

      return querySoFar.andWhere(function () {
        cov_ifas5nbx0.f[45]++;
        cov_ifas5nbx0.s[138]++;

        addWhereClause(this, value); // Within the function, 'this' refers to the query so far
      });
    } else {
        cov_ifas5nbx0.b[38][1]++;
        cov_ifas5nbx0.s[139]++;
        if (key === QUERY_CONJUNCTIONS.OR) {
          cov_ifas5nbx0.b[39][0]++;
          cov_ifas5nbx0.s[140]++;

          return querySoFar.orWhere(function () {
            cov_ifas5nbx0.f[46]++;
            cov_ifas5nbx0.s[141]++;

            addWhereClause(this, value); // Within the function, 'this' refers to the query so far
          });
        } else {
            cov_ifas5nbx0.b[39][1]++;
            cov_ifas5nbx0.s[142]++;
            if (key === QUERY_CONJUNCTIONS.RAW) {
              cov_ifas5nbx0.b[40][0]++;

              var _ref29 = (cov_ifas5nbx0.s[143]++, value),
                  _ref29$sql = _ref29.sql,
                  sql = _ref29$sql === undefined ? (cov_ifas5nbx0.b[41][0]++, value) : _ref29$sql,
                  parameters = _ref29.parameters;

              cov_ifas5nbx0.s[144]++;

              return querySoFar.whereRaw(sql, parameters);
            } else {
              cov_ifas5nbx0.b[40][1]++;
            }
          }
      }cov_ifas5nbx0.s[145]++;
    if (value === undefined) {
      cov_ifas5nbx0.b[42][0]++;
      cov_ifas5nbx0.s[146]++;

      return querySoFar; // Ignore undefined criteria
    } else {
      cov_ifas5nbx0.b[42][1]++;
    }
    cov_ifas5nbx0.s[147]++;
    if (value === null) {
      cov_ifas5nbx0.b[43][0]++;
      cov_ifas5nbx0.s[148]++;

      return querySoFar.whereNull(key);
    } else {
      cov_ifas5nbx0.b[43][1]++;
    }

    var _ref30 = (cov_ifas5nbx0.s[149]++, value),
        _ref30$comparisonType = _ref30.comparisonType,
        comparisonType = _ref30$comparisonType === undefined ? (cov_ifas5nbx0.b[44][0]++, 'where') : _ref30$comparisonType,
        _ref30$comparator = _ref30.comparator,
        comparator = _ref30$comparator === undefined ? (cov_ifas5nbx0.b[45][0]++, Array.isArray(value) ? (cov_ifas5nbx0.b[46][0]++, 'in') : (cov_ifas5nbx0.b[46][1]++, '=')) : _ref30$comparator,
        _ref30$comparisonValu = _ref30.comparisonValue,
        comparisonValue = _ref30$comparisonValu === undefined ? (cov_ifas5nbx0.b[47][0]++, value) : _ref30$comparisonValu,
        _ref30$ignoreCase = _ref30.ignoreCase,
        ignoreCase = _ref30$ignoreCase === undefined ? (cov_ifas5nbx0.b[48][0]++, false) : _ref30$ignoreCase;

    cov_ifas5nbx0.s[150]++;

    if (ignoreCase) {
      cov_ifas5nbx0.b[49][0]++;
      cov_ifas5nbx0.s[151]++;

      return querySoFar.whereRaw('LOWER(:key:) ' + comparator + ' LOWER(:comparisonValue)', {
        key: key,
        comparisonValue: comparisonValue
      });
    } else {
      cov_ifas5nbx0.b[49][1]++;
    }

    var _ref31 = (cov_ifas5nbx0.s[152]++, value),
        _ref31$args = _ref31.args,
        args = _ref31$args === undefined ? (cov_ifas5nbx0.b[50][0]++, [comparator, comparisonValue]) : _ref31$args;

    cov_ifas5nbx0.s[153]++;

    return querySoFar[comparisonType].apply(querySoFar, [key].concat((0, _toConsumableArray3.default)(args)));
  }, baseQuery);
}

function addJoin(baseQuery, recordType, joinOptions) {
  cov_ifas5nbx0.f[47]++;

  // Default join condition is of the form 'primary.id = secondary.primary_id',
  // e.g. survey_response.id = answer.survey_response_id
  var _ref32 = (cov_ifas5nbx0.s[154]++, joinOptions),
      joinWith = _ref32.joinWith,
      _ref32$joinType = _ref32.joinType,
      joinType = _ref32$joinType === undefined ? (cov_ifas5nbx0.b[51][0]++, JOIN_TYPES.DEFAULT) : _ref32$joinType,
      _ref32$joinCondition = _ref32.joinCondition,
      joinCondition = _ref32$joinCondition === undefined ? (cov_ifas5nbx0.b[52][0]++, [recordType + '.id', joinWith + '.' + recordType + '_id']) : _ref32$joinCondition,
      _ref32$joinConditions = _ref32.joinConditions,
      joinConditions = _ref32$joinConditions === undefined ? (cov_ifas5nbx0.b[53][0]++, [joinCondition]) : _ref32$joinConditions;

  var joinMethod = (cov_ifas5nbx0.s[155]++, joinType ? (cov_ifas5nbx0.b[54][0]++, joinType + 'Join') : (cov_ifas5nbx0.b[54][1]++, 'join'));
  cov_ifas5nbx0.s[156]++;
  return baseQuery[joinMethod](joinWith, function () {
    cov_ifas5nbx0.f[48]++;

    var joining = (cov_ifas5nbx0.s[157]++, this.on.apply(this, (0, _toConsumableArray3.default)(joinConditions[0])));
    cov_ifas5nbx0.s[158]++;
    for (var joinConditionIndex = 1; joinConditionIndex < joinConditions.length; joinConditionIndex++) {
      cov_ifas5nbx0.s[159]++;

      joining.andOn.apply(joining, (0, _toConsumableArray3.default)(joinConditions[joinConditionIndex]));
    }
  });
}